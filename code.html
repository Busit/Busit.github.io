<!DOCTYPE html>
<html>
	<head>
		<title>Busit - Developers</title>
		<meta name="description" content="Busit Developer Portal" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="cache-control" content="no-cache, must-revalidate" /> 
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" /> 
		<link rel="shortcut icon" href="img/favicon.ico" />
		<link rel="stylesheet" href="css/main.css" type="text/css" />
		<script type="text/javascript" src="js/main.js"></script>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		
		<link class="codestyle" rel="stylesheet" href="css/github.css">
		<script type="text/javascript" src="js/highlight.pack.js"></script>
	</head>
	<body>
		<div id="footerfix">
			<header>
				<div class="content">
					<div class="logo">
						<a href="//www.busit.com"><img src="img/logo_white.png" alt="logo" /></a>
						<em>Developer Portal</em>
					</div>
			<nav id="navigation">
				<ul id="mainmenu">
					<li><a href="index.html">Home</a></li>
					<li><a href="concepts.html">Learn</a></li>
					<li><a href="settings.html">Think</a></li>
					<li><a href="code.html">Code</a></li>
					<li><a href="publish.html">Publish</a></li>
				</ul>
			</nav>
			
				</div>
			</header>
			<div id="content">

			<h1>Let's <strong>Code</strong> a bit</h1>
<a name="start"><h2 onclick="return; $(this).next().slideToggle(500);">Before we start</h2></a>
<div class="answer">
	<p>Busit supports multiple programming languages for connectors. However, only <strong>PHP 5</strong> is open for developers at this time. 
	You can find the complete reference on <a href="//php.net/">php.net</a>.<br />
	It is highly recommended that you'd be familiar with <a href="//en.wikipedia.org/wiki/Object-oriented_programming">OOP</a>.</p>
	<ul>
		<li>Connectors are <strong>stateless</strong> and must have a parameterless constructor, see <a href="#lifecycle">lifecycle</a> section for more details.</li>
		<li>PHP connectors are using <a href="//php.net/manual/en/language.namespaces.php">namespaces</a>. 
			However, it is recommended that you leave your code in the default namespace.</li>
		<li>PHP connectors are composed of at least one class <em>(and ideally only one)</em>.</li>
		<li>Connectors must be <a href="publish.html">validated by Busit</a> prior to be available on the platform.</li>
		<li>All programming languages supported share the same object model <em>(as close as possible)</em>, 
			this may lead to unusual methods or structures for certain languages but allows to have a common meaningful documentation.</li>
		<li>For most accurate class documentation, see the <a href="javadoc/">javadoc</a></li>
		<li>You should define the connector's capabilities and settings, name, description, translations, what interfaces it supports, what are
			the configuration parameters,...This is done via the <a href="settings.html">configuration file</a>. Then, you can write the 
			actual code of your connector according to the settings you have declared.</li>
	</ul>
	
	<h3>1) Basic structure</h3>
	<p>There are 2 basic requirements for a PHP connector:</p>
	<ol>
		<li>You must define the <strong>__CLASSNAME__</strong> constant to provide the name of the connector class to be instanciated.</li>
<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\HelloWorld");
</code></pre>
		<li>You must <strong>extend</strong> the abstract class <a href="javadoc/com/busit/Connector.html"><em>com\busit\Connector</em></a> and 
			<strong>implement</strong> <em>(at least)</em> one of the  
					<a href="#producer"><em>com\busit\Producer</em></a>,
					<a href="#consumer"><em>com\busit\Consumer</em></a> or 
					<a href="#transformer"><em>com\busit\Transformer</em></a> patterns.
		</li>
<pre><code class="php">
class HelloWorld extends com\busit\Connector implements com\busit\Producer
{
	...
}
</code></pre>
	</ol>
	<p>The <strong>Connector</strong> abstract class implements a bunch of behaviors to help you, don't bother about it. If you want to know what is
	available for you to use safely, look at the <a href="javadoc/com/busit/ConnectorHelper.html"><em>ConnectorHelper</em><a> interface:</p>
<pre><code class="php">
interface ConnectorHelper
{
	public function config($key); 	// returns the matching config parameter (or all if $key == null)
	public function input($key); 	// returns the matching input interface (or all if $key == null)
	public function output($key); 	// returns the matching output interface (or all if $key == null)
	
	public function id(); 	// returns a unique id for the user instance of the connector
	public function locale(); 	// returns the preferred language of the user
	
	public function notifyUser($message); 	// send warnings to the user (use sparsely)
	public function notifyOwner($message, $data); 	// send warnings to the developper (aka: you) (use sparsely)
}
</code></pre>

	<h3>2) Lifecycle</h3>
	<p>Everytime a connector is triggered, a new instance of the class is created. After processing the message, the class instance is destroyed. 
	This means that there is no persistency nor any kind of state of the class once the lifecycle is complete: connectors are <strong>stateless</strong>.</p>
	<p class="we_say">If your connector absolutely requires an internal state or some sort of history, you should setup one of your own using external services or you 
	should have a <em>premium developer account</em> so that Busit provides such mechanism to you.</p>
	<ol>
		<li>The class specified by the <strong>__CLASSNAME__</strong> constant is instanciated using a parameterless constructor.</li>
		<li>If you implemented the <strong>Consumer</strong> pattern, then the 
			<a href="javadoc/com/busit/Consumer.html#consume(com.busit.IMessage,%20com.busit.Interface)">
			<em>consume()</em></a> method is called once for the targetted interface only.</li>
		<li>The Busit broker checks if there are any other connectors in the flow ; if there are any:
			<ul>
				<li>If you implemented the <strong>Producer</strong> pattern, then the 
					<a href="javadoc/com/busit/Producer.html#produce(com.busit.IMessage,%20com.busit.Interface)">
					<em>produce()</em></a> method is called once for each connected output.</li>
				<li>If you implemented the <strong>Transformer</strong> pattern, then the 
					<a href="javadoc/com/busit/Transformer.html#transform(com.busit.IMessage,%20com.busit.Interface,%20com.busit.Interface)">
					<em>transform()</em></a> method is called once for each connected output.</li>
			</ul>
		</li>
		<li>Your connector's class instance is destroyed</li>
	</ol>
	<p>This means that internal variables will be maintained between <strong>consume()</strong> and subsequent <strong>produce()</strong> or 
		<strong>transform()</strong> calls.</p>
</div>

<a name="producer"><h2 onclick="return; $(this).next().slideToggle(500);"><strong>Producer</strong> pattern</h2></a>
<div class="answer">
	<p>If your connector brings data from external devices or services, it is producing data for Busit.<br />
	External devices or services can <strong>push</strong> data directly on your connector, or your connector can <strong>pull</strong>
	from those at regular intervals (see <a href="#cron">automatic interfaces</a>)</p>
	<p>The producer pattern provides a single <a href="javadoc/com/busit/Producer.html#produce(com.busit.Interface)"><em>produce()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function produce($out);</code></pre>
	<ul>
		<li>The <strong>$out</strong> parameter is of type <a href="javadoc/com/busit/Connector.Interface.html"><em>com\busit\Interface</em></a> and represents the output
			interface that should produce data. <a href="#interfaces">More about Interfaces</a>.</li>
		<li>The method must return an <a href="javadoc/com/busit/IMessage.html"><em>com\busit\IMessage</em></a> or <em>null</em> 
		if there is no content to be produced.</li>
	</ul>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\WeatherStation");

class WeatherStation extends com\busit\Connector implements com\busit\Producer
{
	public function produce($out)
	{
		if( !$this-&gt;hasData() )
			return null;
		
		$message = com\busit\Factory::message();
		$content = $message->content();
		if( $out-&gt;key == 'pressure' )
			content['data'] = $this-&gt;getPressure();
		else if( $out-&gt;key == 'temperature' )
			content['data'] = $this-&gt;getTemperature();
			
		return $message;
	}
	
	private function hasData() { ... }
	private function getPressure() { ... }
	private function getTemperature() { ... }
}

?&gt;
	</code></pre>
</div>

<a name="consumer"><h2 onclick="return; $(this).next().slideToggle(500);"><strong>Consumer</strong> pattern</h2></a>
<div class="answer">
	<p>If your connector sends data to external devices or services, it is consuming data from Busit.</p>
	<p>The consumer pattern provides a single <a href="javadoc/com/busit/Consumer.html#consume(com.busit.IMessage,%20com.busit.Interface)"><em>consume()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function consume($message, $in);</code></pre>
	<ul>
		<li>The <strong>$message</strong> parameter is of type <a href="javadoc/com/busit/IMessage.html"><em>com\busit\IMessage</em></a> and contains the actual data. 
			<a href="#messages">More about Messages</a>.</li>
		<li>The <strong>$in</strong> parameter is of type <a href="javadoc/com/busit/Interface.html"><em>com\busit\Interface</em></a> and represents the input
			interface to which data should be sent. <a href="#interfaces">More about Interfaces</a>.</li>
		<li>The method does not return anything.</li>
	</ul>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\Light");

class Light extends com\busit\Connector implements com\busit\Consumer
{
	public function consume($message, $in)
	{
		$content = $message-&gt;content():
		if( $in-&gt;key == 'state' )
		{
			if( $content['data'] == 'ON' )
				$this-&gt;turnOn();
			else
				$this-&gt;turnOff();
		}
		
		if( $in-&gt;key == 'color' )
			$this-&gt;changeColor($content['data']);
	}
	
	private function turnOn() { ... }
	private function turnOff() { ... }
	private function changeColor($color) { ... }
}

?&gt;
	</code></pre>
</div>

<a name="transformer"><h2 onclick="return; $(this).next().slideToggle(500);"><strong>Transformer</strong> pattern</h2></a>
<div class="answer">
	<p>If your connector aims at modifying or enhancing data eventually using external services, it is transforming data for Busit.</p>
	<p>The transformer pattern provides a single <a href="javadoc/com/busit/Transformer.html#transform(com.busit.IMessage,%20com.busit.Interface,%20com.busit.Interface)"><em>transform()</em></a> 
	method with the following signature:</p>
	<pre><code class="php">public function transform($message, $in, $out);</code></pre>
	<ul>
		<li>The <strong>$message</strong> parameter is of type <a href="javadoc/com/busit/IMessage.html"><em>com\busit\IMessage</em></a> and contains the actual data. 
			<a href="#messages">More about Messages</a>.</li>
		<li>The <strong>$in</strong> parameter is of type <a href="javadoc/com/busit/Connector.Interface.html"><em>com\busit\Interface</em></a> and gives you a hint on what data is comming in.
			 <a href="#interfaces">More about Interfaces</a>.</li>
		<li>The <strong>$out</strong> parameter is of type <a href="javadoc/com/busit/Connector.Interface.html"><em>com\busit\Interface</em></a> and tells you what the user wants to come out.
			<a href="#interfaces">More about Interfaces</a>.</li>
		<li>The method must return an <a href="javadoc/com/busit/IMessage.html"><em>com\busit\IMessage</em></a> <em>(ideally the same with its data transformed)</em> 
			or <em>null</em> if you want to stop the flow and prevent further processing.</li>
	</ul>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\Translator");

class Translator extends com\busit\Connector implements com\busit\Transformer
{
	public function transform($message, $in, $out)
	{
		if( $in-&gt;key == $out-&gt;key )
		{
			// no need to translate :)
			return $message;
		}
		
		$content = $message->content();
		if( $in-&gt;key == 'french' && $out-&gt;key == 'english' )
		{
			$content['data'] = $this-&gt;FRtoEN($content['data']);
			return $message;
		}
		
		if( $in-&gt;key == 'english' && $out-&gt;key == 'french' )
		{
			$content['data'] = $this-&gt;ENtoFR($content['data']);
			return $message;
		}
		
		// we do not support another translation so break the flow
		return null;
	}
	
	private function FRtoEN($text) { ... }
	private function ENtoFR($text) { ... }
}

?&gt;
	</code></pre>
</div>

<a name="messages"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>messages</strong></h2></a>
<div class="answer">
	<p>The messages convey data across the connectors and make sure the content is encrypted with the user's identity. All messages are of type 
	<a href="javadoc/com/busit/IMessage.html"><em>com\busit\IMessage</em></a>. You can change the message content but
	you <strong>cannot create new messages</strong> because it requires to be initialized with the user's identity which you don't have ! However, you can 
	<a href="javadoc/com/busit/IMessage.html#duplicate()">
	<em>duplicate()</em></a> an existing message if needed.<br />Anyhow, since your code's entry point is one of the <em>consume()</em>,
	<em>produce()</em> or <em>transform()</em> methods, you'll already have a message at that point.</p>
	<p>The content of the messages is split in 2 parts <em>(just like an email)</em> :</p>
	<ol>
		<li>The textual <strong>content</strong> can be set or retreived in <a href="//en.wikipedia.org/wiki/UTF-8">UTF8</a> encoding or as raw
		binary.
<pre><code class="php">
$text = $message-&gt;getContentUTF8();
$message-&gt;setContentUTF8('Hello World!');

$bytes = $message-&gt;getContentBinary();
$message-&gt;setContentBinary($data);
</code></pre>
		However, there is a possibility to format the message content in a structured way using a <strong>Known Type</strong>. <a href="#knowntype">More about Known Types</a>.<br /><br />
		</li>
		<li>The <strong>attachments</strong> that can contain pictures, files,...
<pre><code class="php">
$files = $message-&gt;getAttachmentNames();
foreach( $files as $f )
	$message-&gt;getAttachment($f);

$message-&gt;addAttachment($name, $data);
</code></pre>
		</li>
	</ol><br /><br />
	<p>Moreover, there are 3 usefull method you can use to get a message class instance:</p>
	<ul>
		<li>To get a brand new clean message, just call the <a href="javadoc/com/busit/Connector.html#empty()">
		<em>clean()</em></a> method from anywhere in your code.<pre><code class="php">$new_message = $this-&gt;clean();</code></pre></li>
		<li>To get a copy of the initial message with the same content, just call the 
		<a href="javadoc/com/busit/Connector.html#copy()"><em>copy()</em></a> method from anywhere in your code.
		<pre><code class="php">$new_message = $this-&gt;copy();</code></pre></li>
		<li>To get the actual real original message, just call the <a href="javadoc/com/busit/Connector.html#original()">
		<em>original()</em></a> method from anywhere in your code.<pre><code class="php">$the_message = $this-&gt;original();</code></pre>
		Be careful with the original message, because if you modify it, you will not be able to get the original content back.</li>
	</ul>
</div>

<a name="interfaces"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>interfaces</strong> (inputs and outputs)</h2></a>
<div class="answer">
	<p>Interfaces <em>(do not confuse with OOP class interface)</em> are either inputs or outputs from your connector.
		When publishing your connector, you should mention the different inputs and outputs that your connector accepts and
		give each of them an internal name (the interface <strong>key</strong>) that will never change. 
		Then, the user can give it a friendly <strong>name</strong>.
		Eventually, for custom interfaces, the user can also specify a <strong>value</strong> for it.</p>
	<p>Example: The mail sender connector has only one input interface with internal key <em>email</em>.<br />
		When the user adds it to his flow, he can add several of those, and thus give them a name and a value:</p>
	<ul>
		<li><strong>Key</strong>: <em>email</em> (this cannot change, the user does not see it, this is only for you, the developer)</li>
		<li><strong>Name</strong>: <em>Bob's mail</em> (this is the friendly name set by the user)</li>
		<li><strong>Value</strong>: <em>bob@example.com</em> (this is the value set by the user)</li>
	</ul>
	<p>So now, in your code, you receive a populated <a href="javadoc/com/busit/Connector.Interface.html">
		<em>com\busit\Interface</em></a> object with the 3 properties <em>key</em>, <em>name</em> and <em>value</em>.
	</p>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\Recommended");

class Recommended extends com\busit\Connector implements com\busit\Consumer
{
	public function consume($message, $in)
	{
		$key = $in-&gt;key; // email
		$name = $in-&gt;name; // Bob's mail
		$value = $in-&gt;value; // bob@example.com
		...
	}
}

?&gt;
	</code></pre>
	<p>This means that now you know which input or output the message was targetting and you can behave accordingly.</p>
</div>

<a name="cron"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>automatic</strong> interfaces (cron)</h2></a>
<div class="answer">
	<p>Automatic interfaces are <strong>input</strong> or <strong>output</strong> <a href="#interfaces">interfaces</a> that are activated at 
	given interval defined by the user.</p>
	<ul>
		<li>An automatic <strong>input</strong> can be for a <strong>Consumer</strong>, saying for instance <em>"Post this tweet (predefined) every day at 8AM"</em> ;
		<br />Or for a <strong>Transformer</strong>, it could mean <em>"Change 1 (1 = the message data) euro (euro = the input interface) into dollars every hour, so I can follow the trends"</em>.</li>
		<li>An automatic <strong>output</strong> only applies to a <strong>Producer</strong>, saying for instance <em>"I want to get the GPS 
		coordinate every minute"</em>.</li>
	</ul>
	<p>Conceptually, the regular <a href="#lifecycle">lifecycle</a> is more or less followed except that the input data is fixed and does not change (set by the user).</p>
	<p>If you implemented the <a href="#consumer"><em>Consumer</em></a> pattern, then the <a href="javadoc/com/busit/Connector.Consumer.html#consume(com.busit.IMessage,%20com.busit.Connector.Interface)"><em>consume()</em></a> method is called as usual for that particular input interface.</p>
<pre><code class="php">
if( $instance instanceof com\busit\Consumer && isInput($interfaceId) )
	$instance-&gt;consume($message, $interfaceId);
</code></pre>
	<p>If you implemented the <a href="#transformer"><em>Transformer</em></a> pattern, then the <a href="javadoc/com/busit/Connector.Transformer.html#transform(com.busit.IMessage,%20com.busit.Connector.Interface,%20com.busit.Connector.Interface)">
	<em>transform()</em></a> method is called as usual for <strong>all</strong> connected outputs.</p>
<pre><code class="php">
if( $instance instanceof com\busit\Transformer && isInput($interfaceId) )
	foreach( $outputs as $out )
		if( hasConnectorsAfter($out) )
			$instance-&gt;transform($message, $interfaceId, $out);
</code></pre>
	<p>If you implemented the <a href="#producer"><em>Producer</em></a> pattern, then the <a href="javadoc/com/busit/Connector.Producer.html#produce(com.busit.IMessage,%20com.busit.Connector.Interface)"><em>produce()</em></a> method is called for that output interface <strong>only</strong>.</p>
<pre><code class="php">
if( $instance instanceof com\busit\Producer && isOutput($interfaceId) )
	if( hasConnectorsAfter($interfaceId) )
		$instance-&gt;produce($message, $interfaceId);
</code></pre>
</div>

<a name="configs"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>configurations</strong></h2></a>
<div class="answer">
	<p>The configuration parameters as you designed them in the <a href="settings.html">connector settings</a> -and later completed by the user- are
	available in your code. Those are automatically populated via the 
	<a href="javadoc/com/busit/Connector.html#init(java.util.Map,%20java.util.Map,%20java.util.Map)">
	<em>com\busit\Connector.init()</em></a> method at the very beginning so you should not bother about it. 
	You can thus retrieve them anywhere in your code via the <a href="javadoc/com/busit/Connector.html#config(java.lang.String)">
	<em>config()</em></a> method that returns the value of the desired configuration parameter as a string.
<pre><code class="php">
$value = $this-&gt;config('my_parameter');
</code></pre></li></ul>
</div>

<a name="knowntype"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>Known Types</strong></h2></a>
<div class="answer">
	<p>A <a href="javadoc/com/busit/KnownType.html"><em>com\busit\KnownType</em></a> is a special 
	structured <a href="#messages">message</a> content in JSON format. It provides information about the type of data that is contained
	in the message and thus, your connector can behave accordingly. Using those, you can declare that
	your message has several information contained, what is compatible with it and format a nice display-able output.<br />
	Behind the scenes, Known Types are composed of:</p>
	<ul>
		<li>A unique <strong>ID</strong> to easily reference it.</li>
		<li>A friendly <strong>name</strong> to display to the user.</li>
		<li>An eventual list of <strong>compatibility</strong> that reference other Known Types' ID that are compatible with it.</li>
		<li>A display <strong>format</strong> that transforms data into something nice.</li>
		<li>Any sort of <strong>fields</strong> that contain data.</li>
	</ul>
	<p>Busit offers an growing list of data structures that anyone can use or enhance. Thus, we
	strongly encourage all developers to acknowledge and use those for maximum compatibility between connectors. Meanwhile, Known Types 
	are not a constraint, they are not immutable and not restrictive... they are only a kind of very flexible indication on what 
	sort of data is contained inside a message.</p>
	<p class="you_say">Whaaaat... too much info at once here...<br />
		Though this is very important !<br />
		Have an example for me ?</p>
	<p class="we_say">Sure dude, step by step :</p>
	
	<h3>1) Principle</h3>
	<p>Lets define a (simplified, fake) known type that says that a "person" has a "name" and a "birthday".
		<br />So your message content can be this JSON:</p>
<pre><code class="json">
{
	"id": 42,
	"name": "person",
	"data":
	{
		"name": "Simon",
		"birthday": 468021600
	}
}
</code></pre>
	<p>If you retrieve this message via <a href="javadoc/com/busit/IMessage.html#getContentUTF8()"><em>getContentUTF8()</em></a> you'll have the JSON string. However, if you retrieve it using <a href="javadoc/com/busit/IMessage.html#getKnownType()"><em>getKnownType()</em></a>, you'll get a 
	<a href="javadoc/com/busit/KnownType.html"><em>com\busit\KnownType</em></a> object that you can use.
	Basically, the system recognizes that the content is a JSON string and that it contains a <strong>data</strong> property. Therefore,
	it assumes that this is a known type. From this point, you can directly access the data fields.</p>
<pre><code class="php">
$knowntype = $message->getKnownType();
$birthday = $knowntype['birthday'];
</code></pre>

	<h3>2) Flexibility</h3>
	<p>As stated at the beginning, known types are just an <em>indication</em> on the <em>intent</em> of what 
	<em>maybe</em> the message <em>might</em> contain, <em>probably</em>.</p>
	<p class="we_say">Noticed how much care was put in this sentence !?</p>
	<p>This means that you can overload it and put more info inside it, ommit some that you do not have, or totally screw up everything:</p>
	<p class="you_say">"name" is now a number, why not,<br />
	"birthday", not any clue,<br />
	but hey, i've got his "favourite color" !</p>
<pre><code class="json">
{
	"id": 42,
	"name": "person",
	"data":
	{
		"name": 123.456,
		"favourite_color": "blue"
	}
}
</code></pre>
	<p>The point is that you do not know what the user (or other connectors) will send you, so you <strong>must check</strong> 
	and anticipate to recieve anything ! However, in general, you can expect to have a minimum of trust, because other developers
	should offer proper known types when they can, and so should you. Nevertheless, with great flexibility comes great responsibility...</p>
<pre><code class="php">
$knowntype = $message->getKnownType();
if( $knowntype != null ) // because it can just be some regular text content
	if( $knowntype->wkid() == 42 ) // because it could be any other known type
		if( $knowntype['birthday'] != null ) // because it may be empty
			$birthday = $knowntype['birthday'];

// if really you tried everything, you can still forfeit
else
	throw new \Exception("I cannot deal with this data");
</code></pre>

	<h3>3) Compatibility</h3>
	<p>Sometimes, using the allowed flexibility that known types offer, it happens that you have more data available, and your message might be compatible with multiple known types. For instance, you still want to expose a "person" using his "name" and "birthday",
	but you also have his location available. And, good news, there is a specific (fake again) known type for "geolocation" :</p>
<pre><code class="json">
{
	"id": 666,
	"name": "geolocation",
	"data":
	{
		"latitude": ...,
		"longitude": ...
	}
}
</code></pre>
	<p>So you can expose the two known types at once using the <em>compatibility</em> array:</p>
<pre><code class="json">
{
	"id": 42,
	"name": "person",
	"compatibility": [666],
	"data":
	{
		"name": "Simon",
		"birthday": 468021600,
		"latitude": 13.1281452,
		"longitude": -61.1771603
	}
}
</code></pre>
	<p>In your code, you can now check if a known type is compatible with another and behave accordingly:</p>
<pre><code class="php">
$kt = $message->getKnownType();
if( $kt != null )
{
	if( $kt->isCompatibleWith(666) )
		$latitude = $kt['latitude'];
	if( $kt->isCompatibleWith(42) )
		$birthday = $kt['birthday'];
}
</code></pre>
	<p>Again, do not forget to check all values before using them, because some evil bad guy could misleadlingly mention that his forged
		fake known type is compatible with some other whereas it is not !</p>
	<p class="we_say">Ever heard about scam, spam, phishing, exploits and so on ?<br />Do not trust anyone...</p>
	<h3>4) Format (nice display)</h3>
	<em>... in progress ... </em>
</div>

<script>hljs.initHighlightingOnLoad();</script>
<script>createShortcutMenu();</script>
			</div>
		</div>
		<footer>
			<div class="social">
				<a class="link" href="//twitter.com/Bus_IT">
					<img src="img/twitter.png" alt="Twitter" />
				</a>
				<a class="link" href="//www.facebook.com/busit.net">
					<img src="img/facebook.png" alt="Facebook" />
				</a>
				<a class="link" href="//plus.google.com/+BusitFr" rel="publisher">
					<img src="img/google.png" alt="Google+" />
				</a>
				<a class="link" href="//www.linkedin.com/company/5121205">
					<img src="img/linkedin.png" alt="LinkedIn" />
				</a>
				<a class="link" href="//www.youtube.com/channel/UCvB9PQcyRzdf8n4AewdE_oA">
					<img src="img/youtube.png" alt="YouTube" />
				</a>
			</div>
			<div class="copyright">&copy; <a href='//www.busit.com'>Busit</a> | <a style='font-weight: bold;' href='//www.sys.as'>SYS Network</a></div>
		</footer>
		<div id="help">
			Is something unclear, you've spotted a mistake, or you need more details ?<br /><br />
			Then please help us <a href="//github.com/Busit/Busit.github.io/issues/new">improve this doc</a>.<br />
			Or <a href="//www.busit.com/about/contact">contact us</a> directly.
		</div>
	</body>
</html>
