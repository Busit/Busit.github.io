<!DOCTYPE html>
<html>
	<head>
		<title>Busit - Developers</title>
		<meta name="description" content="Busit Developer Portal" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="cache-control" content="no-cache, must-revalidate" /> 
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" /> 
		<link rel="shortcut icon" href="img/favicon.ico" />
		<link rel="stylesheet" href="css/main.css" type="text/css" />
		<script type="text/javascript" src="js/main.js"></script>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		
		<link class="codestyle" rel="stylesheet" href="css/github.css">
		<script type="text/javascript" src="js/highlight.pack.js"></script>
	</head>
	<body>
		<div id="footerfix">
			<header>
				<div class="content">
					<div class="logo">
						<a href="//www.busit.com"><img src="img/logo_white.png" alt="logo" /></a>
						<em>Developer Portal</em>
					</div>
			<nav id="navigation">
				<ul id="mainmenu">
					<li><a href="index.html">Home</a></li>
					<li><a href="concepts.html">Learn</a></li>
					<li><a href="settings.html">Think</a></li>
					<li><a href="code.html">Code</a></li>
					<li><a href="publish.html">Publish</a></li>
				</ul>
			</nav>
			
				</div>
			</header>
			<div id="content">

			<h1>Let's <strong>Code</strong> a bit</h1>
<a name="start"><h2 onclick="return; $(this).next().slideToggle(500);">Before we start</h2></a>
<div class="answer">
	<p>Busit supports multiple programming languages for BusApps. However, only <strong>PHP 5</strong> is open for developers at this time. 
	You can find the complete reference on <a href="//php.net/">php.net</a>.<br />
	It is highly recommended that you'd be familiar with <a href="//en.wikipedia.org/wiki/Object-oriented_programming">OOP</a>.</p>
	<ul>
		<li>BusApps are <strong>stateless</strong> and must have a parameterless constructor, see lifecycle below for more details.</li>
		<li>PHP BusApps are using <a href="//php.net/manual/en/language.namespaces.php">namespaces</a>. 
			However, it is recommended that you leave your code in the default namespace.</li>
		<li>PHP BusApps are composed of at least one class <em>(and ideally only one)</em>.</li>
		<li>BusApps must be <a href="publish.html">validated by Busit</a> prior to be available on the platform.</li>
		<li>All programming languages supported share the same object model <em>(as close as possible)</em>, 
			this may lead to unusual methods or structures for PHP but allows to have a common meaningful documentation for all programming languages.</li>
		<li>For most accurate class documentation, see the <a href="javadoc/">javadoc</a></li>
		<li>You should define the BusApp's capabilities and settings, name, description, translations, what channels it supports, what are
			the configuration parameters,...This is done via the <a href="settings.html">configuration file</a>. Then, you can write the 
			actual code of your BusApp according to the settings you have declared.</li>
	</ul>
	
	<h3>1) Basic structure</h3>
	<p>There are 2 basic requirements for a PHP BusApp:</p>
	<ol>
		<li>You must define the <strong>__CLASSNAME__</strong> constant to provide the name of the BusApp class to be instanciated.</li>
<pre><code class="php">
define("__CLASSNAME__", "\\HelloWorld");
</code></pre>
		<li>You must <strong>extend</strong> the abstract class <a href="javadoc/com/busit/App.html"><em>com\busit\App</em></a> and 
			<strong>implement</strong> <em>(at least)</em> one of the  
					<a href="#producer"><em>com\busit\Producer</em></a>,
					<a href="#consumer"><em>com\busit\Consumer</em></a> or 
					<a href="#transformer"><em>com\busit\Transformer</em></a> patterns.
		</li>
<pre><code class="php">
class HelloWorld extends com\busit\App implements com\busit\Producer
{
	...
}
</code></pre>
	</ol>
	<p>The <strong>App</strong> abstract class implements a bunch of behaviors to help you:</p>
<pre><code class="php">
abstract class App
{
	public function config($key); 	// returns the matching config parameter (or all if $key == null)
	public function input($key); 	// returns the matching input channel (or all if $key == null)
	public function output($key); 	// returns the matching output channel (or all if $key == null)
	
	public function id(); 		// returns a unique id for the user instance of the BusApp
	public function locale(); 	// returns the preferred language of the user
	
	public function notifyUser($message); 		// send warnings to the user (use sparsely)
	public function notifyOwner($message, $data); 	// send warnings to the developper (aka: you) (use sparsely)
}
</code></pre>

	<h3>2) Lifecycle</h3>
	<p>Everytime a BusApp is triggered, a new instance of the class is created. After processing the message, the class instance is destroyed. 
	This means that there is no persistency nor any kind of state of the class once the lifecycle is complete: BusApps are <strong>stateless</strong>.</p>
	<p class="we_say">If your BusApp absolutely requires an internal state or some sort of history, you should setup one of your own using external services or you 
	should have a <em>premium developer account</em> so that Busit provides such mechanism to you.</p>
	<ol>
		<li>The class specified by the <strong>__CLASSNAME__</strong> constant is instanciated using a parameterless constructor.</li>
		<li>If you implemented the <strong>Consumer</strong> pattern, then the 
			<a href="javadoc/com/busit/Consumer.html#consume(com.busit.Message, com.busit.Channel)">
			<em>consume()</em></a> method is called once for the targetted channel only.</li>
		<li>The Busit broker checks if there are any other BusApps in the flow ; if there are any:
			<ul>
				<li>If you implemented the <strong>Producer</strong> pattern, then the 
					<a href="javadoc/com/busit/Producer.html#produce(com.busit.Message, com.busit.Channel)">
					<em>produce()</em></a> method is called once for each connected output.</li>
				<li>If you implemented the <strong>Transformer</strong> pattern, then the 
					<a href="javadoc/com/busit/Transformer.html#transform(com.busit.Message, com.busit.Channel, com.busit.Channel)">
					<em>transform()</em></a> method is called once for each connected output.</li>
			</ul>
		</li>
		<li>Your BusApp's class instance is destroyed</li>
	</ol>
	<p>This means that internal variables will be maintained between <strong>consume()</strong> and subsequent <strong>produce()</strong> or 
		<strong>transform()</strong> calls.</p>
</div>

<a name="producer"><h2 onclick="return; $(this).next().slideToggle(500);"><strong>Producer</strong> pattern</h2></a>
<div class="answer">
	<p>If your BusApp brings data from external devices or services, it is producing data for Busit.<br />
	External devices or services can <strong>push</strong> data directly on your BusApp, or your BusApp can <strong>pull</strong>
	from those at regular intervals (see <a href="#cron">automatic channels</a>)</p>
	<p>The producer pattern provides a <a href="javadoc/com/busit/Producer.html#produce(com.busit.Channel, com.busit.Content)"><em>produce()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function produce($out);</code></pre>
	<ul>
		<li>The <strong>$out</strong> parameter is of type <a href="javadoc/com/busit/Channel.html"><em>com\busit\Channel</em></a> and represents the output
			channel that should produce data. <a href="#channels">More about Channels</a>.</li>
		<li>The method must return an <a href="javadoc/com/busit/Message.html"><em>com\busit\Message</em></a> or <em>null</em> 
		if there is no content to be produced.</li>
	</ul>
	<p>Moreover, it provides a <a href="javadoc/com/busit/Producer.html#sample(com.busit.Channel)"><em>sample()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function sample($out);</code></pre>
	<ul>
		<li>The <strong>$out</strong> parameter is of type <a href="javadoc/com/busit/Channel.html"><em>com\busit\Channel</em></a> and represents the output
			channel for which to get sample data. <a href="#channels">More about Channels</a>.</li>
		<li>The method should return an <a href="javadoc/com/busit/Message.html"><em>com\busit\Message</em></a> or <em>null</em> 
		if there no data can be produced from that channel.</li>
	</ul>
	<p>Finally, it provides a <a href="javadoc/com/busit/Producer.html#test()"><em>test()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function test();</code></pre>
	<ul>
		<li>The method should return a boolean value indicating if the BusApp is working properly. This is where you should check any possible dependency.</li>
	</ul>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\WeatherStation");

class WeatherStation extends com\busit\App implements com\busit\Producer
{
	public function produce($out)
	{
		if( !$this-&gt;hasData() )
			return null;
		
		$message = com\busit\Factory::message();
		$content = $message->content();
		if( $out-&gt;key == 'pressure' )
			content['data'] = $this-&gt;getPressure();
		else if( $out-&gt;key == 'temperature' )
			content['data'] = $this-&gt;getTemperature();
			
		return $message;
	}
	
	public function sample($out)
	{
		$message = com\busit\Factory::message();
		$content = $message->content();
		content['data'] = 42;
		
		return $message;
	}
	
	public function test()
	{
		...
		return true;
	}
	
	private function hasData() { ... }
	private function getPressure() { ... }
	private function getTemperature() { ... }
}

?&gt;
	</code></pre>
</div>

<a name="consumer"><h2 onclick="return; $(this).next().slideToggle(500);"><strong>Consumer</strong> pattern</h2></a>
<div class="answer">
	<p>If your BusApp sends data to external devices or services, it is consuming data from Busit.</p>
	<p>The consumer pattern provides <a href="javadoc/com/busit/Consumer.html#consume(com.busit.Message, com.busit.Channel)"><em>consume()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function consume($message, $in);</code></pre>
	<ul>
		<li>The <strong>$message</strong> parameter is of type <a href="javadoc/com/busit/Message.html"><em>com\busit\Message</em></a> and contains the actual data. 
			<a href="#messages">More about Messages</a>.</li>
		<li>The <strong>$in</strong> parameter is of type <a href="javadoc/com/busit/Channel.html"><em>com\busit\Channel</em></a> and represents the input
			channel to which data should be sent. <a href="#channels">More about Channels</a>.</li>
		<li>The method does not return anything.</li>
	</ul>
	<p>Moreover, it provides a <a href="javadoc/com/busit/Consumer.html#test()"><em>test()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function test();</code></pre>
	<ul>
		<li>The method should return a boolean value indicating if the BusApp is working properly. This is where you should check any possible dependency.</li>
	</ul>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\Light");

class Light extends com\busit\App implements com\busit\Consumer
{
	public function consume($message, $in)
	{
		$content = $message-&gt;content():
		if( $in-&gt;key == 'state' )
		{
			if( $content['data'] == 'ON' )
				$this-&gt;turnOn();
			else
				$this-&gt;turnOff();
		}
		
		if( $in-&gt;key == 'color' )
			$this-&gt;changeColor($content['data']);
	}
	
	public function test()
	{
		...
		return true;
	}
	
	private function turnOn() { ... }
	private function turnOff() { ... }
	private function changeColor($color) { ... }
}

?&gt;
	</code></pre>
</div>

<a name="transformer"><h2 onclick="return; $(this).next().slideToggle(500);"><strong>Transformer</strong> pattern</h2></a>
<div class="answer">
	<p>If your BusApp aims at modifying or enhancing data eventually using external services, it is transforming data for Busit.</p>
	<p>The transformer pattern provides <a href="javadoc/com/busit/Transformer.html#transform(com.busit.Message, com.busit.Channel, com.busit.Channel)"><em>transform()</em></a> 
	method with the following signature:</p>
	<pre><code class="php">public function transform($message, $in, $out);</code></pre>
	<ul>
		<li>The <strong>$message</strong> parameter is of type <a href="javadoc/com/busit/Message.html"><em>com\busit\Message</em></a> and contains the actual data. 
			<a href="#messages">More about Messages</a>.</li>
		<li>The <strong>$in</strong> parameter is of type <a href="javadoc/com/busit/Channel.html"><em>com\busit\Channel</em></a> and gives you a hint on what data is comming in.
			 <a href="#channels">More about Channels</a>.</li>
		<li>The <strong>$out</strong> parameter is of type <a href="javadoc/com/busit/Channel.html"><em>com\busit\Channel</em></a> and tells you what the user wants to come out.
			<a href="#channels">More about Channels</a>.</li>
		<li>The method must return an <a href="javadoc/com/busit/Message.html"><em>com\busit\Message</em></a> <em>(ideally the same with its data transformed)</em> 
			or <em>null</em> if you want to stop the flow and prevent further processing.</li>
	</ul>
	<p>Moreover, it provides a <a href="javadoc/com/busit/Transformer.html#test()"><em>test()</em></a> 
		method with the following signature:</p>
	<pre><code class="php">public function test();</code></pre>
	<ul>
		<li>The method should return a boolean value indicating if the BusApp is working properly. This is where you should check any possible dependency.</li>
	</ul>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\Translator");

class Translator extends com\busit\App implements com\busit\Transformer
{
	public function transform($message, $in, $out)
	{
		if( $in-&gt;key == $out-&gt;key )
		{
			// no need to translate :)
			return $message;
		}
		
		$content = $message->content();
		if( $in-&gt;key == 'french' && $out-&gt;key == 'english' )
		{
			$content['data'] = $this-&gt;FRtoEN($content['data']);
			return $message;
		}
		
		if( $in-&gt;key == 'english' && $out-&gt;key == 'french' )
		{
			$content['data'] = $this-&gt;ENtoFR($content['data']);
			return $message;
		}
		
		// we do not support another translation so break the flow
		return null;
	}
	
	public function test()
	{
		...
		return true;
	}
	
	private function FRtoEN($text) { ... }
	private function ENtoFR($text) { ... }
}

?&gt;
	</code></pre>
</div>

<a name="messages"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>messages</strong></h2></a>
<div class="answer">
	<p>The <a href="javadoc/com/busit/Message.html"><em>com\busit\Message</em></a> conveys data across the BusApps and make sure the 
	content is encrypted with the user's identity... hopefully, this is all transparent for you.</p>
	
	<h3>1) IMessage</h3>
	<p>Messages are composed of the following elements:</p>
	<ul>
		<li>The <strong>content</strong> exposed as a <a href="javadoc/com/busit/Content.html"><em>com\busit\Content</em></a> structure</li>
		<li>The <strong>files</strong> that can contain pictures, attachments,...</li>
	</ul>
<pre><code class="php">
interface Message
{
	public function file($name, $data = null); // Get or Set a file for the message
	public function files();		// Get all files attached to the message
	
	public function content($data = null); 	// Get or Set the content of the message
	
	public function clear(); 		// Clears the content and files of the message
	public function copy(); 		// Get a shallow copy of the message (files content is referenced and not copied)
}
</code></pre>
	<p>You can obtain a new <em>Message</em> instance using the <a href="javadoc/com/busit/Factory.html"><em>com/busit/Factory</em></a>:</p>
<pre><code class="php">
$message = com\busit\Factory::message();
</code></pre>

	<h3>2) MessageList</h3>
	<p>In case you want to return multiple messages at once, you can use a <a href="javadoc/com/busit/MessageList.html"><em>com\busit\MessageList</em></a>
	which is a wrapper around Message that behaves just like an array. Do not try to use it as an <em>Message</em> because it will throw at you... 
	Simply append other messages to it.<br />Note that nested MessageList is not supported.</p>
<pre><code class="php">
interface MessageList extends Message, ArrayAccess, Countable, IteratorAggregate
{
}
</code></pre>
	<p>You can obtain a new <em>IMessageList</em> instance using the <a href="javadoc/com/busit/Factory.html"><em>com/busit/Factory</em></a>:</p>
<pre><code class="php">
$list = com\busit\Factory::messageList();

$list[] = $message1;
$list[] = $message2;
</code></pre>

	<h3>3) Content</h3>
	<p>The actual content of the message is a very flexible structure that allows developers to strenghten compatibility accross BusApps.
		See it as a kind of high-level <em>Mime type</em> for data. A extensible set of predefined content types is available so that everyone 
		can share common data structures. In the end, it behaves like an array in which you can put arbitrary key/value pairs.</p>
	<p>Content has:</p>
	<ul>
		<li>An <strong>id</strong> that uniquely identifies the <em>type</em> of content</li>
		<li>A friendly <strong>name</strong> because it is always better than an id... but you should not rely on it !</li>
		<li>A list of <strong>compatibility</strong> to share common values as another existing type</li>
		<li>A <strong>text format</strong> template used to represent this content as simple text</li>
		<li>A <strong>html format</strong> template used to represent this content as html</li>
	</ul>
<pre><code class="php">
interface Content
{
	public function id($value = null); 		// Get or Set the id
	public function name($value = null);		// Get or Set the name
	
	public function compatible($id, $value = null); // Get or Set the compatibility with another content type
	public function compatibility($list = null); 	// Get or Set the list of compatible content types
	
	public function textFormat($value = null); 	// Get or Set the text format template
	public function toText($format = null); 	// Apply the text format to the data
	
	public function htmlFormat($value = null); 	// Get or Set the text format template
	public function toHtml($format = null); 	// Apply the html format to the data
	
	public function toJson(); 			// Get a json representation of this entire content type including data
	public function merge($content); 		// import another content's data into this one
}
</code></pre>
	<p>You can obtain a new <em>Content</em> instance using the <a href="javadoc/com/busit/Factory.html"><em>com/busit/Factory</em></a>:</p>
<pre><code class="php">
$content = com\busit\Factory::content(42); // get content type with id 42
$content['answer'] = 42;
$content['question'] = 'undefined';
</code></pre>
	<p>For more info about content types compatibility, text and html formats,... See <a href="#content">deep into message content</a>.</p>
</div>

<a name="channels"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>channels</strong> (inputs and outputs)</h2></a>
<div class="answer">
	<p>Channels are either inputs or outputs from your BusApp.
		When publishing your BusApp, you should mention the different inputs and outputs that your BusApp accepts and
		give each of them an internal name (the channel <strong>key</strong>) that will never change. 
		Then, the user can give it a friendly <strong>name</strong>.
		Eventually, for custom channels, the user can also specify a <strong>value</strong> for it.</p>
	<p>Example: The mail sender BusApp has only one input channel with internal key <em>email</em>.<br />
		When the user adds it to his flow, he can add several of those, and thus give them a name and a value:</p>
	<ul>
		<li><strong>Key</strong>: <em>email</em> (this cannot change, the user does not see it, this is only for you, the developer)</li>
		<li><strong>Name</strong>: <em>Bob's mail</em> (this is the friendly name set by the user)</li>
		<li><strong>Value</strong>: <em>bob@example.com</em> (this is the value set by the user)</li>
	</ul>
	<p>So now, in your code, you receive a populated <a href="javadoc/com/busit/Channel.html">
		<em>com\busit\Channel</em></a> object with the 3 properties <em>key</em>, <em>name</em> and <em>value</em>.
	</p>
	<pre><code class="php">
&lt;?php
define("__CLASSNAME__", "\\Mailer");

class Mailer extends com\busit\App implements com\busit\Consumer
{
	public function consume($message, $in)
	{
		$key = $in-&gt;key; // email
		$name = $in-&gt;name; // Bob's mail
		$value = $in-&gt;value; // bob@example.com
		...
	}
}

?&gt;
	</code></pre>
	<p>This means that you know which input or output the message was targetting and you can behave accordingly.</p>
	
	<h3>About <strong>automatic</strong> channels (cron)</h3>
	<p>Automatic channels are <strong>output</strong> <a href="#channels">channels</a> of the <strong>producer</strong> pattern that are activated at 
	given interval defined by the user. I.e.: <em>"I want to get the GPS coordinate every minute"</em>.</p>
	<p>Hence, the <a href="javadoc/com/busit/Producer.html#produce(com.busit.Channel)"><em>produce()</em></a> method will be called at defined interval for
		that output channel only (even if other channels are connected).</p>
</div>

<a name="configs"><h2 onclick="return; $(this).next().slideToggle(500);">About <strong>configurations</strong></h2></a>
<div class="answer">
	<p>The configuration parameters as you designed them in the <a href="settings.html">BusApp settings</a> -and later completed by the user- are
	available in your code. You can thus retrieve them anywhere via the <a href="javadoc/com/busit/App.html#config(java.lang.String)">
	<em>config()</em></a> method that returns the value of the desired configuration parameter as a string.</p>
<pre><code class="php">
$value = $this-&gt;config('my_parameter');
</code></pre>

	<h3>Bindable config parameters</h3>
	<p><a href="concepts.html#binding">Binding</a> will occur before your BusApp is created, so the bindable config parameters 
		will already be populated with the proper value.<br />Keep in mind that binding is <em>optionnal</em> from the user's perspective 
		so you should always check if the config contains the value you expect !</p>
</div>

<a name="content"><h2 onclick="return; $(this).next().slideToggle(500);">Deep into message <strong>content</strong></h2></a>
<div class="answer">
	<p>Busit offers an growing list of data structures that anyone can use or enhance. Thus, we
	strongly encourage all developers to acknowledge and use those for maximum compatibility between BusApps. Meanwhile, content types 
	are not a constraint, they are not immutable and not restrictive... they are only a kind of very flexible indication on what 
	sort of data is contained inside a message.</p>
	
	<h3>1) Principle</h3>
	<p>Lets define a (simplified, fake) known type that says that a "person" has a "name" and a "birthday".
		<br />So your <em>IContent</em> can be represented with this JSON:</p>
<pre><code class="json">
{
	"id": 42,
	"name": "person",
	"data":
	{
		"name": null,
		"birthday": null
	}
}
</code></pre>
<pre><code class="php">
$content = com\busit\Factory::content(42);
$content['name'] = 'Simon';
$content['birthday'] = 468021600;
</code></pre>

	<h3>2) Flexibility</h3>
	<p>As stated at the beginning, content types are just an <em>indication</em> on the <em>intent</em> of what 
	<em>maybe</em> the message <em>might</em> contain, <em>probably</em>.</p>
	<p class="we_say">Noticed how much care was put in this sentence !?</p>
	<p>This means that you can overload it and put more info inside it, ommit some that you do not have, or totally screw up everything:</p>
	<p class="you_say">"name" is now a number, why not,<br />
	"birthday", not any clue,<br />
	but hey, i've got his "favourite color" !</p>
<pre><code class="php">
$content = com\busit\Factory::content(42);
$content['name'] = 123;
$content['favourite_color'] = 'blue';
</code></pre>
	<p>The point is that you do not know what the user (or other BusApps) will send you, so you <strong>must check</strong> 
	and anticipate to recieve anything ! However, in general, you can expect to have a minimum of trust, because other developers
	should offer proper content types when they can, and so should you. Nevertheless, with great flexibility comes great responsibility...</p>
<pre><code class="php">
$content = $message->content();
if( $content->id() == 42 ) // because it could be any other content type
	if( $content['birthday'] != null && is_numeric($content['birthday']) ) // because it may be empty or crap
		$birthday = date('m/d/Y', $content['birthday']);
</code></pre>

	<h3>3) Compatibility</h3>
	<p>Sometimes, using the allowed flexibility that content types offer, it happens that you have more data available, and your message 
	might be compatible with multiple other content types. For instance, you still want to expose a "person" using his "name" and "birthday",
	but you also have his location available. And, good news, there is a specific (fake again) known type for "geolocation" :</p>
<pre><code class="json">
{
	"id": 666,
	"name": "geolocation",
	"data":
	{
		"latitude": null,
		"longitude": null
	}
}
</code></pre>
	<p>So you can expose the two known types at once using the <em>compatibility</em> array:</p>
<pre><code class="json">
{
	"id": 42,
	"name": "person",
	"compatibility": [666],
	"data":
	{
		"name": null,
		"birthday": null,
		"latitude": null,
		"longitude": null
	}
}
</code></pre>
	<p>In your code, you can now check if a known type is compatible with another and behave accordingly:</p>
<pre><code class="php">
$content = $message->content();
if( $content->compatible(666) )
{
	$content['latitude'] = 13.1281452;
	$content['longitude'] = -61.177160;
}
</code></pre>

	<h3>4) Format (nice display)</h3>
	<p>There are 2 different format templates that can be applied to the content when necessary: text and html. Depending on the needs,
		one may want to display the data (i.e.) in a file so there should be some kind of representation of that data.</p>
<pre><code class="json">
{
	"textFormat": "Name: {{name}}, Birthday: {{birthday}}",
	"htmlFormat": "Name: &lt;/em>{{name}}&lt;em>, Birthday: &lt;em>{{birthday}}&lt;/em>",
}
</code></pre>
<pre><code class="php">
file_put_contents("profile.html", $content->toHtml());
</code></pre>
	<p>The content type format can be modified according to your needs. Therefore, if you overload the content type, you can modify its representation as well.</p>
<pre><code class="php">
$content['favourite_color'] = 'blue';
$content->textFormat($content->textFormat() . ", Favourite Color: {{favourite_color}}");
</code></pre>
	<p>Data properties can be enclosed in double curly braces <strong>{{</strong>property<strong>}}</strong> so they will be replaced when required.<br />
		If a matching data property cannot be found, the tag is ignored and removed.<br />
		In order to access nested properties, you can use the dot as separator. Array elements can be accessed with numeric 0-based index:</p>
<pre><code class="json">
{
	"data":
	{
		"name": null,
		"address":
		{
			"street": null,
			"city": null
		},
		"colors": []
	}
	"textFormat": "Name: {{name}}, City: {{address.city}}, Favourite color: {{colors.0}}"
}
</code></pre>
	<p>Powerful yet incomplete because there is no current way of defining a simple format that implies loops or conditions,... If you really want to have
		total control over the representation, then consider implementing it directly in your BusApp.</p>
	<p>Note that for the html format, some tags are not allowed (stripped): <em>script, object, embed,...</em></p>
	
	<h3>5) Obtain a content type</h3>
	<p>As shown before, you can request a content type by its id using the <a href="javadoc/com/busit/Factory.html"><em>com/busit/Factory</em></a>. Then,
		you receive a pre-filled content type with all data properties set to null.</p>
	<p>If you specify a wrong (unknown) id, then it will fallback on the default content type with id zero:</p>
<pre><code class="json">
{
	"id": 0,
	"name": "Data",
	"compatibility": [],
	"data": { "data": null },
	"textFormat": "{{data}}",
	"htmlFormat": "&lt;pre>{{data}}&lt;/pre>"
}
</code></pre>
	<p>When sending a new message to Busit, you can send the json representation of the content type and it will be automatically interpreted. If it fails,
		it will create a default content type with the data property set to whatever you sent.</p>
	<p>If you want to completely forge a content type and not use the default, you can use the <em>Factory</em> with a <strong>negative</strong> id (whichever).
		This will return a completely empty <em>IContent</em> (no id, no name, no format,...).</p>
	<p>The message <em>content()</em> method will always return a valid content type. It will eventually fallback on the default if it cannot resolve it.</p>
<pre><code class="php">
$message->content(null);
echo $message->$content()->id(); // will echo '0' (default content type)
</code></pre>
</div>

<script>hljs.initHighlightingOnLoad();</script>
<script>createShortcutMenu();</script>
			</div>
		</div>
		<footer>
			<div class="copyright">&copy; <a href='//www.busit.com'>Busit</a></div>
		</footer>
		<div id="help">
			Is something unclear, you've spotted a mistake, or you need more details ?<br /><br />
			Then please help us <a href="//github.com/Busit/Busit.github.io/issues/new">improve this doc</a>.<br />
			Or <a href="//www.busit.com/contact">contact us</a> directly.
		</div>
	</body>
</html>
